{
    "type" : "app",

    "roles" : {
        "apache2" : {
            "fixedcontext" : "",
            "apache2modules" : [
                "proxy",
                "proxy_http"
            ],

            "appconfigitems" : [
                {
                    "type" : "file",
                    "name" : "${appconfig.apache2.appconfigfragmentfile}",
                    "template"     : "tmpl/htaccess.tmpl",
                    "templatelang" : "varsubst"
                },
                {
                    "type"         : "directory",
                    "name"         : "/var/lib/mattermost/${appconfig.appconfigid}",
                    "uname"        : "mattermost",
                    "gname"        : "mattermost"
                },
                {
                    "type"         : "directory",
                    "name"         : "/var/lib/mattermost/${appconfig.appconfigid}/data",
                    "uname"        : "mattermost",
                    "gname"        : "mattermost",
                    "retentionpolicy"  : "keep",
                    "retentionbucket"  : "datadir"
                },
                {
                    "type"         : "file",
                    "name"         : "/etc/mattermost/${appconfig.appconfigid}.json",
                    "template"     : "tmpl/config.json.tmpl",
                    "templatelang" : "varsubst"
                },
                {
                    "type"         : "systemd-service",
                    "name"         : "mattermost@${appconfig.appconfigid}",
                },
            ]
        },
        "mysql" : {
            "appconfigitems" : [
                {
                    "type"             : "database",
                    "name"             : "maindb",
                    "retentionpolicy"  : "keep",
                    "retentionbucket"  : "maindb",
                    "privileges"       : "all privileges"
                }
            ]
        }
    }
}
